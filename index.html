<html>
    <script>
        var map = [
                   { entry_idx:    0, junctA_idx:   0, junctB_idx:   1, tot_dist_km:  0.90, port_dist_m:     0, num_port:  0}, // Smoke Lake -> Smoke Lake (middle)
                   { entry_idx:   -1, junctA_idx:   1, junctB_idx:   2, tot_dist_km:  2.40, port_dist_m:     0, num_port:  0}, // Smoke Lake (middle) -> Smoke Lake (south)
                   { entry_idx:   -1, junctA_idx:   2, junctB_idx:   3, tot_dist_km:  3.40, port_dist_m:   240, num_port:  1}, // Smoke Lake (south) -> Ragged Lake
                   { entry_idx:   -1, junctA_idx:   2, junctB_idx:   4, tot_dist_km:  3.40, port_dist_m:  1115, num_port:  3}, // Smoke Lake (south) -> Claude Lake
                   { entry_idx:   -1, junctA_idx:   3, junctB_idx:   4, tot_dist_km:  2.80, port_dist_m:  1065, num_port:  3}, // Ragged Lake -> Claude Lake
                   { entry_idx:   -1, junctA_idx:   3, junctB_idx:   4, tot_dist_km:  4.90, port_dist_m:   350, num_port:  1}, // Ragged Lake -> Claude Lake
                   { entry_idx:   -1, junctA_idx:   3, junctB_idx:   5, tot_dist_km:  3.90, port_dist_m:   590, num_port:  1}, // Ragged Lake -> Big Porcupine Lake (north)
                   { entry_idx:   -1, junctA_idx:   5, junctB_idx:   6, tot_dist_km:  2.70, port_dist_m:     0, num_port:  0}, // Big Porcupine Lake (north) -> Big Porcupine Lake (middle)
                   { entry_idx:   -1, junctA_idx:   5, junctB_idx:   6, tot_dist_km:  1.00, port_dist_m:   395, num_port:  1}, // Big Porcupine Lake (north) -> Big Porcupine Lake (middle)
                   { entry_idx:   -1, junctA_idx:   6, junctB_idx:   7, tot_dist_km:  1.00, port_dist_m:     0, num_port:  0}, // Big Porcupine Lake (middle) -> Big Porcupine Lake (south)
                   { entry_idx:   -1, junctA_idx:   7, junctB_idx:   8, tot_dist_km:  1.80, port_dist_m:   220, num_port:  1}, // Big Porcupine Lake (south) -> Little Coon Lake
                   { entry_idx:   -1, junctA_idx:   8, junctB_idx:   9, tot_dist_km:  1.00, port_dist_m:   930, num_port:  1}, // Little Coon Lake -> Lower Whatnot Lake
                   { entry_idx:   -1, junctA_idx:   9, junctB_idx:  10, tot_dist_km:  1.80, port_dist_m:   140, num_port:  1}, // Lower Whatnot Lake -> McGarvey Lake (west)
                   { entry_idx:   -1, junctA_idx:  10, junctB_idx:  11, tot_dist_km:  1.30, port_dist_m:     0, num_port:  0}, // McGarvey Lake (west) -> McGarvey Lake (east)
                   { entry_idx:   -1, junctA_idx:  11, junctB_idx:  12, tot_dist_km:  4.60, port_dist_m:  1895, num_port:  2}, // McGarvey Lake (east) -> Bonnechere Lake (south)
                   { entry_idx:   -1, junctA_idx:   7, junctB_idx:  12, tot_dist_km:  1.80, port_dist_m:   200, num_port:  1}, // Big Porcupine Lake (south) -> Bonnechere Lake (south)
                   { entry_idx:   -1, junctA_idx:  12, junctB_idx:  13, tot_dist_km:  1.80, port_dist_m:    50, num_port:  1}, // Bonnechere Lake (south) -> Cradle Lake
                   { entry_idx:   -1, junctA_idx:  12, junctB_idx:  13, tot_dist_km:  2.10, port_dist_m:    40, num_port:  1}, // Bonnechere Lake (south) -> Cradle Lake
                   { entry_idx:   -1, junctA_idx:  12, junctB_idx:  14, tot_dist_km:  6.90, port_dist_m:   950, num_port:  3}, // Bonnechere Lake (south) -> Lawrence Lake
                   { entry_idx:   -1, junctA_idx:  13, junctB_idx:  14, tot_dist_km:  5.10, port_dist_m:  1000, num_port:  4}, // Cradle Lake -> Lawrence Lake
                   { entry_idx:   -1, junctA_idx:  13, junctB_idx:  15, tot_dist_km:  9.80, port_dist_m:  4275, num_port:  8}, // Cradle Lake -> Cache Lake (south)
                   { entry_idx:   -1, junctA_idx:  14, junctB_idx:  16, tot_dist_km:  0.10, port_dist_m:     0, num_port:  0}, // Lawrence Lake -> Pardee Lake
                   { entry_idx:   -1, junctA_idx:  16, junctB_idx:  17, tot_dist_km:  5.90, port_dist_m:  1035, num_port:  1}, // Pardee Lake -> Head Lake
                   { entry_idx:   -1, junctA_idx:  17, junctB_idx:  18, tot_dist_km:  1.90, port_dist_m:   290, num_port:  1}, // Head Lake -> Kenneth Lake
                   { entry_idx:   -1, junctA_idx:  17, junctB_idx:  15, tot_dist_km:  2.70, port_dist_m:  1640, num_port:  1}, // Head Lake -> Cache Lake (south)
                   { entry_idx:    1, junctA_idx:  19, junctB_idx:  15, tot_dist_km:  1.90, port_dist_m:     0, num_port:  0}, // Cache Lake (north) -> Cache Lake (south)
                   { entry_idx:    1, junctA_idx:  19, junctB_idx:  20, tot_dist_km:  3.10, port_dist_m:     0, num_port:  0}, // Cache Lake (north) -> Tanamakoon Lake
                   { entry_idx:   -1, junctA_idx:  20, junctB_idx:   1, tot_dist_km:  6.90, port_dist_m:  1560, num_port:  4}, // Tanamakoon Lake -> Smoke Lake (middle)
                   { entry_idx:   -1, junctA_idx:  17, junctB_idx:  21, tot_dist_km:  4.40, port_dist_m:   460, num_port:  3}, // Head Lake -> Ma-Da-Was-Ka
                   { entry_idx:   -1, junctA_idx:  15, junctB_idx:  21, tot_dist_km:  5.70, port_dist_m:   550, num_port:  2}, // Cache Lake (south) -> Ma-Da-Was-Ka
                   { entry_idx:    2, junctA_idx:  22, junctB_idx:  21, tot_dist_km:  7.40, port_dist_m:   245, num_port:  2}, // Lake of Two Rivers -> Ma-Da-Was-Ka
                   ]
        
        var segments = [
                        { available: 1, from_junct_idx:   0, to_junct_idx:   1, map_idx:   0, time_minutes: 0},
                        { available: 1, from_junct_idx:  19, to_junct_idx:  15, map_idx:  25, time_minutes: 0},
                        { available: 1, from_junct_idx:  19, to_junct_idx:  20, map_idx:  26, time_minutes: 0},
                        { available: 1, from_junct_idx:  22, to_junct_idx:  21, map_idx:  30, time_minutes: 0},
                        { available: 1, from_junct_idx:   1, to_junct_idx:   0, map_idx:   0, time_minutes: 0},
                        { available: 1, from_junct_idx:   1, to_junct_idx:   2, map_idx:   1, time_minutes: 0},
                        { available: 1, from_junct_idx:   2, to_junct_idx:   1, map_idx:   1, time_minutes: 0},
                        { available: 1, from_junct_idx:   2, to_junct_idx:   3, map_idx:   2, time_minutes: 0},
                        { available: 1, from_junct_idx:   3, to_junct_idx:   2, map_idx:   2, time_minutes: 0},
                        { available: 1, from_junct_idx:   2, to_junct_idx:   4, map_idx:   3, time_minutes: 0},
                        { available: 1, from_junct_idx:   4, to_junct_idx:   2, map_idx:   3, time_minutes: 0},
                        { available: 1, from_junct_idx:   3, to_junct_idx:   4, map_idx:   4, time_minutes: 0},
                        { available: 1, from_junct_idx:   4, to_junct_idx:   3, map_idx:   4, time_minutes: 0},
                        { available: 1, from_junct_idx:   3, to_junct_idx:   4, map_idx:   5, time_minutes: 0},
                        { available: 1, from_junct_idx:   4, to_junct_idx:   3, map_idx:   5, time_minutes: 0},
                        { available: 1, from_junct_idx:   3, to_junct_idx:   5, map_idx:   6, time_minutes: 0},
                        { available: 1, from_junct_idx:   5, to_junct_idx:   3, map_idx:   6, time_minutes: 0},
                        { available: 1, from_junct_idx:   5, to_junct_idx:   6, map_idx:   7, time_minutes: 0},
                        { available: 1, from_junct_idx:   6, to_junct_idx:   5, map_idx:   7, time_minutes: 0},
                        { available: 1, from_junct_idx:   5, to_junct_idx:   6, map_idx:   8, time_minutes: 0},
                        { available: 1, from_junct_idx:   6, to_junct_idx:   5, map_idx:   8, time_minutes: 0},
                        { available: 1, from_junct_idx:   6, to_junct_idx:   7, map_idx:   9, time_minutes: 0},
                        { available: 1, from_junct_idx:   7, to_junct_idx:   6, map_idx:   9, time_minutes: 0},
                        { available: 1, from_junct_idx:   7, to_junct_idx:   8, map_idx:  10, time_minutes: 0},
                        { available: 1, from_junct_idx:   8, to_junct_idx:   7, map_idx:  10, time_minutes: 0},
                        { available: 1, from_junct_idx:   8, to_junct_idx:   9, map_idx:  11, time_minutes: 0},
                        { available: 1, from_junct_idx:   9, to_junct_idx:   8, map_idx:  11, time_minutes: 0},
                        { available: 1, from_junct_idx:   9, to_junct_idx:  10, map_idx:  12, time_minutes: 0},
                        { available: 1, from_junct_idx:  10, to_junct_idx:   9, map_idx:  12, time_minutes: 0},
                        { available: 1, from_junct_idx:  10, to_junct_idx:  11, map_idx:  13, time_minutes: 0},
                        { available: 1, from_junct_idx:  11, to_junct_idx:  10, map_idx:  13, time_minutes: 0},
                        { available: 1, from_junct_idx:  11, to_junct_idx:  12, map_idx:  14, time_minutes: 0},
                        { available: 1, from_junct_idx:  12, to_junct_idx:  11, map_idx:  14, time_minutes: 0},
                        { available: 1, from_junct_idx:   7, to_junct_idx:  12, map_idx:  15, time_minutes: 0},
                        { available: 1, from_junct_idx:  12, to_junct_idx:   7, map_idx:  15, time_minutes: 0},
                        { available: 1, from_junct_idx:  12, to_junct_idx:  13, map_idx:  16, time_minutes: 0},
                        { available: 1, from_junct_idx:  13, to_junct_idx:  12, map_idx:  16, time_minutes: 0},
                        { available: 1, from_junct_idx:  12, to_junct_idx:  13, map_idx:  17, time_minutes: 0},
                        { available: 1, from_junct_idx:  13, to_junct_idx:  12, map_idx:  17, time_minutes: 0},
                        { available: 1, from_junct_idx:  12, to_junct_idx:  14, map_idx:  18, time_minutes: 0},
                        { available: 1, from_junct_idx:  14, to_junct_idx:  12, map_idx:  18, time_minutes: 0},
                        { available: 1, from_junct_idx:  13, to_junct_idx:  14, map_idx:  19, time_minutes: 0},
                        { available: 1, from_junct_idx:  14, to_junct_idx:  13, map_idx:  19, time_minutes: 0},
                        { available: 1, from_junct_idx:  13, to_junct_idx:  15, map_idx:  20, time_minutes: 0},
                        { available: 1, from_junct_idx:  15, to_junct_idx:  13, map_idx:  20, time_minutes: 0},
                        { available: 1, from_junct_idx:  14, to_junct_idx:  16, map_idx:  21, time_minutes: 0},
                        { available: 1, from_junct_idx:  16, to_junct_idx:  14, map_idx:  21, time_minutes: 0},
                        { available: 1, from_junct_idx:  16, to_junct_idx:  17, map_idx:  22, time_minutes: 0},
                        { available: 1, from_junct_idx:  17, to_junct_idx:  16, map_idx:  22, time_minutes: 0},
                        { available: 1, from_junct_idx:  17, to_junct_idx:  18, map_idx:  23, time_minutes: 0},
                        { available: 1, from_junct_idx:  18, to_junct_idx:  17, map_idx:  23, time_minutes: 0},
                        { available: 1, from_junct_idx:  17, to_junct_idx:  15, map_idx:  24, time_minutes: 0},
                        { available: 1, from_junct_idx:  15, to_junct_idx:  17, map_idx:  24, time_minutes: 0},
                        { available: 1, from_junct_idx:  15, to_junct_idx:  19, map_idx:  25, time_minutes: 0},
                        { available: 1, from_junct_idx:  20, to_junct_idx:  19, map_idx:  26, time_minutes: 0},
                        { available: 1, from_junct_idx:  20, to_junct_idx:   1, map_idx:  27, time_minutes: 0},
                        { available: 1, from_junct_idx:   1, to_junct_idx:  20, map_idx:  27, time_minutes: 0},
                        { available: 1, from_junct_idx:  17, to_junct_idx:  21, map_idx:  28, time_minutes: 0},
                        { available: 1, from_junct_idx:  21, to_junct_idx:  17, map_idx:  28, time_minutes: 0},
                        { available: 1, from_junct_idx:  15, to_junct_idx:  21, map_idx:  29, time_minutes: 0},
                        { available: 1, from_junct_idx:  21, to_junct_idx:  15, map_idx:  29, time_minutes: 0},
                        { available: 1, from_junct_idx:  21, to_junct_idx:  22, map_idx:  30, time_minutes: 0},
                        ]
        
        var num_entries =   4
        
        var entrypoints = ["6", "8", "A10"]
        
        var junctions = ["Smoke Lake", "Smoke Lake (middle)", "Smoke Lake (south)", "Ragged Lake", "Claude Lake", "Big Porcupine Lake (north)", "Big Porcupine Lake (middle)", "Big Porcupine Lake (south)", "Little Coon Lake", "Lower Whatnot Lake", "McGarvey Lake (west)", "McGarvey Lake (east)", "Bonnechere Lake (south)", "Cradle Lake", "Lawrence Lake", "Cache Lake (south)", "Pardee Lake", "Head Lake", "Kenneth Lake", "Cache Lake (north)", "Tanamakoon Lake", "Ma-Da-Was-Ka", "Lake of Two Rivers"]
        
        
function not_finished_exploring(route, desired_trip_length_minutes, route_time_minutes)
{
    // first, try to go further from here
    if (route_time_minutes < desired_trip_length_minutes + 180)
    {
        var last_junction_idx = segments[route[route.length-1]].to_junct_idx;
        for (var i = 0; i < segments.length; i++)
        {
            if ((segments[i].from_junct_idx == last_junction_idx) && (segments[i].available == 1))
            {
                route_time_minutes += segments[i].time_minutes;
                route.push(i);
                segments[i].available = 0;
                return route_time_minutes;
            }
        }
    }
    // second, backup
    var last_segment_idx = route.pop();
    route_time_minutes -= segments[last_segment_idx].time_minutes;
    segments[last_segment_idx].available = 1;
    while(route.length > 0)
    {
        for (var i = last_segment_idx + 1; i < segments.length; i++)
        {
            if ((segments[i].from_junct_idx == last_junction_idx) && (segments[i].available == 1))
            {
                route_time_minutes += segments[i].time_minutes;
                route.push(i);
                segments[i].available = 0;
                return route_time_minutes;
            }
        }
        // backup some more
        last_segment_idx = route.pop();
        route_time_minutes -= segments[last_segment_idx].time_minutes;
        segments[last_segment_idx].available = 1;
    }
    return 0;
}

  
function findRoutes()
{
    // clear whatever was in the div before
    document.getElementById('para').innerHTML = "";

    // get the user parameters out of the form elements
    var desired_trip_length_hours = document.getElementById('trip_length_hours').value;
    var desired_trip_length_minutes = desired_trip_length_hours * 60;
    var kilometer_per_hour_paddling = document.getElementById('kilometer_per_hour_paddling').value;
    var meters_per_hour_portage = document.getElementById('meters_per_hour_portage').value;
    var load_and_unload_minutes = document.getElementById('load_and_unload_minutes').value;
    
    // calculate the cost of each segment using the user supplied parameters
    for (var i = 0; i < segments.length; i++)
    {
        segments[i].available = 1;
        segments[i].time_minutes =  map[segments[i].map_idx].tot_dist_km / kilometer_per_hour_paddling * 60 +
                                    map[segments[i].map_idx].port_dist_m / meters_per_hour_portage * 60 +
                                    map[segments[i].map_idx].num_port * load_and_unload_minutes;
    }

    var count = 0;
    for (var i = 0; i < num_entries; i++)
    {
        var route = [];
        var route_time_minutes = segments[i].time_minutes;
        route.push(i);
        
        while ((count < 100) && ((route_time_minutes = not_finished_exploring(route, desired_trip_length_minutes, route_time_minutes)) > 0))
        {
            if (segments[route[0]].from_junct_idx == segments[route[route.length-1]].to_junct_idx)  // are we back where we started?
            {
                document.getElementById('para').innerHTML += " hello<br>";
                if ((route_time_minutes > (desired_trip_length_minutes * 0.95)) && (route_time_minutes < (desired_trip_length_minutes * 1.05)))
                {
                    document.getElementById('para').innerHTML += " route: " + count + " <br>";
                    count++;
                }
            }
        }
    }
}
        
</script>
Desired Trip Length: <input type="text" id="trip_length_hours" value="30" size="6"> Hours<br>
Average Paddling Speed: <input type="text" id="kilometer_per_hour_paddling" value="2.7" size="6"> Kilometers / Hour<br>
Average Portage Speed: <input type="text" id="meters_per_hour_portage" value="1000" size="6"> Meters / Hour<br>
Average Unload + Load Time: <input type="text" id="load_and_unload_minutes" value="15" size="6"> Minutes<br>
<input type='button' onclick='findRoutes()' value='Suggest Routes'/>
<hr>
Routes:
<p id='para'></p>
</html>
